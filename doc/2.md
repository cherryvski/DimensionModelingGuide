  企业的总线矩阵是用于设计与管理数据仓库架构的基本工具。总线矩阵中，行表示业务过程或事实，列表示维度。其基本作用如下：

- 管理数仓的开发需求。新增矩阵的一行，可以代表需要为某个业务过程/事实新增一个维度模型（即需要开发一个新的事实表），且可以表达出这个维度模型需要关联哪些维度；新增矩阵的一列，可以代表新增一个维度（即需要开发一个/多个维度表，同时与部分事实表关联），且可以表达出这个维度需要跨越哪些业务过程并保持一致性。通过这种方式，可以将数仓的开发变为一种相对敏捷、灵活的开发模式，多个开发小组可按数据域划分并同步开展开发工作。
- 为数仓的使用者提供检索工具。当指标开发者使用数仓的维度模型进行指标开发时，可通过检索总线矩阵来找到如下信息：
  - 某个业务过程下包含的事实。这可以帮助指标开发者找到自己要开发的指标可以关联上哪些维度。
  - 哪些事实之间共享一致的维度。这可以帮助指标开发者确定某些复合指标需求（例如投诉率、平均人数）能够关联哪些维度，因为只有构成这个复合指标的多个事实共享了一致性的维度，这个复合指标才能按这些一致性维度由对应的事实上卷得出。
  
  因此，总线矩阵（细节总线矩阵）可以看作是维度模型的概要设计，其设计可按下面几个步骤组成。

## 识别业务过程

  业务过程是企业中所完成的微观的动作，比如获得订单、开取发票等。它包含如下几个特征：

- 业务过程通过由动宾结构组成。
- 业务过程通过由某个操作型系统支撑。

  在需求调研阶段，我们已从业务部门和IT部门处收集到了企业的业务、指标分析需求、业务系统数据的情况。此时我们应该结合收集来的数据进行识别，试图找出业务部门所描述的【业务】一列所对应的操作型系统的表，若能找到对应，则说明该【业务】是业务过程；若不能找到对应，则说明该【业务】还不是业务过程，应该还能继续拆分为更细的业务过程，或者其描述不准确。

## 声明粒度

  粒度代表事实表每行表达的是什么。粒度由业务过程对应的操作型系统对应的表的实现决定。粒度应该以业务术语描述，例如：

- 每个银行账户每月情况采用一行表示。
- 仓库中每种材料库存水平的每日快照采用一行表示。

## 确定维度

   维度是描述事实/度量的环境，即“谁、什么、何处、何时、为何、如何”。

   在前面识别业务过程时也知道了这个业务过程对应的操作型系统的哪张表，此时可以分析得出某个业务过程应该与哪些维度相关联。例如：一个商品销售的业务过程，它对应的交易表中可以找到商品id、交易时间戳、客户id这些字段，那么我们可以获知这个业务过程可以与商品、时间、客户这些维度相关联。

## 确定事实

​    事实是指过程的度量。例如，交易过程中，交易金额便是其事实。

​    在前面得知一个业务过程对应的操作型系统的表后，可以从这张表中找到对应可描述事实的字段。需要注意的是，有的事实并非像金额这样的可累加型的度量，会直接呈现在表字段中，这种事实需要根据业务需求的驱动进而识别出来。例如，业务关注每个地区的交易总次数，而交易订单表里面，并没有交易次数这一字段，因此这个事实应该是从业务需求侧出发去识别出来的。

## 形成总线矩阵文档

结合以上四步，可以输出一份总线矩阵文档，作为维度模型设计的需求输入。参考《维度建模工具箱》一书中的描述，总线矩阵文档格式可以是如下：

| 业务过程 | 事实     | 粒度描述         | 事实表名    | 来源表 | 日期 | 产品 |
| -------- | -------- | ---------------- | ----------- | ------ | ---- | ---- |
| 购买订单 | 订单金额 | 每个订单一行     | dwd_order_d | xxx    | √    |      |
| 货运通知 | 货运数量 | 每个货运通知一行 | dwd_xxx     | xxx    | √    | √    |

个人认为，构建总线矩阵的核心目的是保证维度和事实的一致性，让数仓的开发及管理方能够有一个全局的视角来检视整个数仓，避免维度或事实的重复建设，从而保障指标的口径一致。所以，在构建和迭代总线矩阵的过程中应该注意，维度应该是唯一的，不能存在两个同名或同义的维度，否则数仓建成后部分事实就没法做横向钻取了。